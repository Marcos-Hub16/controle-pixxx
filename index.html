<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Protagonismo</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .tabs { margin-bottom: 20px; }
    .tablink { padding: 10px 20px; cursor: pointer; margin-right: 5px; }
    .tablink.active { background-color: #333; color: white; }
    .tabcontent { display: none; }
    .card { margin-top: 20px; }
    input { margin: 5px 0; padding: 5px; width: 200px; }
    button { padding: 5px 10px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 5px; text-align: left; }
    th { background-color: #eee; }
  </style>
</head>
<body>

  <h1>Protagonismo</h1>
  <p>Organize quem pagou</p>

  <!-- Abas -->
  <div class="tabs">
    <button class="tablink active" onclick="openTab('enviar', event)">Enviar Pix</button>
    <button class="tablink" onclick="openTab('lista', event)">Lista de Pagamentos</button>
    <button class="tablink" onclick="openTab('adm', event)">ADM</button>
  </div>

  <!-- Aba Enviar Pix -->
  <div id="enviar" class="tabcontent" style="display:block;">
    <div class="card">
      <input type="text" id="nome" placeholder="Digite seu nome">
      <input type="number" id="valor" placeholder="Valor (ex: 2,00)" step="0.01" min="0">
      <button onclick="iniciarPagamento(this)">Pagar</button>
    </div>
  </div>

  <!-- Aba Lista de Pagamentos -->
  <div id="lista" class="tabcontent">
    <h2>Pagamentos registrados</h2>
    <table id="tabelaPagamentos">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Valor (R$)</th>
          <th>Data/Hora</th>
          <th>Remover</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <h3>Total arrecadado: R$ <span id="total">0,00</span></h3>
  </div>

  <!-- Aba ADM -->
  <div id="adm" class="tabcontent">
    <h2>Painel ADM</h2>
    <p>Saldo: R$ <span id="saldoADM">0,00</span></p>

    <input type="password" id="senhaADM" placeholder="Senha ADM">
    <button onclick="entrarADM()">Entrar</button>

    <div id="painelADM" style="display:none;">
      <h3>Retirar verba</h3>
      <input type="number" id="retirarValor" placeholder="Quanto retirar?" step="0.01" min="0">
      <button onclick="retirarVerba()">Retirar</button>

      <h3>Adicionar verba</h3>
      <input type="number" id="adicionarValor" placeholder="Quanto adicionar?" step="0.01" min="0">
      <button onclick="adicionarVerba()">Adicionar</button>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD8_Xn_GpvfAVsu-uZVve2h7ivz78bE6I8",
      authDomain: "controle-pix-8f3b5.firebaseapp.com",
      projectId: "controle-pix-8f3b5",
      storageBucket: "controle-pix-8f3b5.firebasestorage.app",
      messagingSenderId: "330284203781",
      appId: "1:330284203781:web:2e1316c9009a3bd18e816c"
    };

    const app = initializeApp(firebaseConfig);
    window.db = getFirestore(app);
  </script>

  <!-- Script principal -->
  <script type="module">
    import { collection, addDoc, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const tabelaBody = document.querySelector("#tabelaPagamentos tbody");
    const totalSpan = document.getElementById("total");

    let retirado = parseFloat(localStorage.getItem("saldoVerbaRetirada")) || 0;
    let adicionada = parseFloat(localStorage.getItem("saldoVerbaAdicionada")) || 0;

    function iniciarPagamento(botao) {
      const nomeInput = document.getElementById("nome");
      const valorInput = document.getElementById("valor");

      const nome = nomeInput.value.trim();
      const valor = parseFloat(valorInput.value);

      if(!nome) { alert("Digite seu nome!"); return; }
      if(isNaN(valor) || valor <= 0) { alert("Digite um valor positivo!"); return; }

      addDoc(collection(window.db,"pagamentos"), {
        nome: nome,
        valor: valor,
        data: new Date()
      });

      nomeInput.value = "";
      valorInput.value = "";
    }

    onSnapshot(collection(window.db,"pagamentos"), snapshot => {
      tabelaBody.innerHTML = "";
      let total = 0;

      const pagamentos = [];
      snapshot.forEach(doc => pagamentos.push({id: doc.id, ...doc.data()}));

      pagamentos.sort((a,b) => new Date(b.data.seconds*1000) - new Date(a.data.seconds*1000));

      pagamentos.forEach(data => {
        const tr = document.createElement("tr");

        const tdNome = document.createElement("td");
        tdNome.textContent = data.nome || "AnÃ´nimo";

        const tdValor = document.createElement("td");
        tdValor.textContent = data.valor.toFixed(2).replace(".", ",");

        const tdData = document.createElement("td");
        tdData.textContent = new Date(data.data.seconds*1000).toLocaleString();

        const tdRemover = document.createElement("td");
        const btnRemover = document.createElement("button");
        btnRemover.textContent = "X";
        btnRemover.style.color = "red";
        btnRemover.style.cursor = "pointer";
        btnRemover.onclick = async () => {
          const senha = prompt("Digite a senha ADM para remover:");
          if(senha === "GCM2026") {
            await deleteDoc(doc(window.db,"pagamentos",data.id));
            atualizarSaldoVerba();
          } else { alert("Senha incorreta!"); }
        };
        tdRemover.appendChild(btnRemover);

        tr.appendChild(tdNome);
        tr.appendChild(tdValor);
        tr.appendChild(tdData);
        tr.appendChild(tdRemover);

        tabelaBody.appendChild(tr);
        total += data.valor;
      });

      totalSpan.textContent = total.toFixed(2).replace(".", ",");
      atualizarSaldoVerba();
    });

    function atualizarSaldoVerba() {
      const total = parseFloat(totalSpan.textContent.replace(",", ".")) || 0;
      const saldo = total + adicionada - retirado;
      document.getElementById("saldoADM").textContent = saldo.toFixed(2).replace(".", ",");
    }

    // Abas
    window.openTab = function(tabName, event) {
      document.querySelectorAll('.tabcontent').forEach(tab => tab.style.display='none');
      document.querySelectorAll('.tablink').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabName).style.display='block';
      if(event) event.currentTarget.classList.add('active');
    }

    // ADM
    window.entrarADM = function() {
      const senha = document.getElementById("senhaADM").value;
      if(senha==="GCM2026") document.getElementById("painelADM").style.display="block";
      else alert("Senha incorreta!");
    }

    window.retirarVerba = function() {
      const valor = parseFloat(document.getElementById("retirarValor").value);
      if(isNaN(valor) || valor<=0){ alert("Digite um valor positivo!"); return; }

      const total = parseFloat(totalSpan.textContent.replace(",", ".")) || 0;
      if(valor > total + adicionada - retirado){ alert("Saldo insuficiente!"); return; }

      retirado += valor;
      localStorage.setItem("saldoVerbaRetirada", retirado);
      atualizarSaldoVerba();
      document.getElementById("retirarValor").value="";
    }

    window.adicionarVerba = function() {
      const valor = parseFloat(document.getElementById("adicionarValor").value);
      if(isNaN(valor) || valor<=0){ alert("Digite um valor positivo!"); return; }

      adicionada += valor;
      localStorage.setItem("saldoVerbaAdicionada", adicionada);
      atualizarSaldoVerba();
      document.getElementById("adicionarValor").value="";
    }
  </script>

</body>
</html>








